---
import { Card } from '@docs/ui/components';

interface Props {
  className?: string;
}

const { className = '' } = Astro.props;
---

<div id="search-results" class:list={['search-results hidden', className]}>
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-bold">検索結果</h2>
    <button id="close-search-results" class="btn btn-sm btn-circle btn-ghost">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
    </button>
  </div>
  
  <div id="search-results-container" class="space-y-4">
    <!-- 検索結果がここに動的に挿入されます -->
    <div id="search-loading" class="py-8 text-center hidden">
      <span class="loading loading-spinner loading-lg"></span>
      <p class="mt-2 opacity-70">検索中...</p>
    </div>
    
    <div id="search-empty" class="py-8 text-center hidden">
      <div class="alert">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-info shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
        <span>検索結果が見つかりませんでした。</span>
      </div>
    </div>
  </div>
</div>

<script>
  // 検索結果の表示と制御
  const searchResults = document.getElementById('search-results');
  const searchResultsContainer = document.getElementById('search-results-container');
  const searchLoading = document.getElementById('search-loading');
  const searchEmpty = document.getElementById('search-empty');
  const closeSearchResults = document.getElementById('close-search-results');
  
  // 検索イベントをリッスン
  document.addEventListener('docsearch', ((event: CustomEvent) => {
    const { query } = event.detail;
    
    if (searchResults && searchLoading && searchEmpty && searchResultsContainer) {
      // 検索結果を表示
      searchResults.classList.remove('hidden');
      
      // ローディング表示
      searchLoading.classList.remove('hidden');
      searchEmpty.classList.add('hidden');
      
      // 既存の結果をクリア
      const existingResults = searchResultsContainer.querySelectorAll('.search-result-item');
      existingResults.forEach(item => item.remove());
      
      // 検索を実行（実際の実装ではAPIコールなど）
      setTimeout(() => {
        performSearch(query);
      }, 500);
    }
  }) as EventListener);
  
  // 閉じるボタンの処理
  if (closeSearchResults && searchResults) {
    closeSearchResults.addEventListener('click', () => {
      searchResults.classList.add('hidden');
    });
  }
  
  // 検索実行関数（実際の実装ではAPIコールなど）
  function performSearch(query: string) {
    if (!searchLoading || !searchEmpty || !searchResultsContainer) return;
    
    // ここでは仮のデモデータを使用
    const demoResults = [
      {
        title: 'はじめに',
        excerpt: 'このドキュメントでは、Astroプロジェクトの基本的な使い方について説明します。',
        url: '/ja/v1/introduction',
        project: 'Astro',
        version: 'v1'
      },
      {
        title: 'コンポーネントの作成',
        excerpt: 'Astroコンポーネントは、UIの再利用可能な部分を定義します。',
        url: '/ja/v1/components/creating-components',
        project: 'Astro',
        version: 'v1'
      }
    ];
    
    // ローディング非表示
    searchLoading.classList.add('hidden');
    
    // 結果の表示
    if (demoResults.length > 0) {
      searchEmpty.classList.add('hidden');
      
      demoResults.forEach(result => {
        const resultElement = document.createElement('div');
        resultElement.className = 'search-result-item';
        resultElement.innerHTML = `
          <a href="${result.url}" class="block">
            <div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow">
              <div class="card-body p-4">
                <div class="flex items-center justify-between">
                  <h3 class="card-title text-base">${result.title}</h3>
                  <div class="badge badge-sm">${result.project} ${result.version}</div>
                </div>
                <p class="text-sm opacity-70">${result.excerpt}</p>
              </div>
            </div>
          </a>
        `;
        searchResultsContainer.appendChild(resultElement);
      });
    } else {
      searchEmpty.classList.remove('hidden');
    }
  }
</script>
