---
import MainLayout from './MainLayout.astro';
import { Sidebar } from '@docs/ui/components';
import { VersionSelector } from '@docs/versioning/components';
import { SearchBar, SearchResults } from '@docs/search/components';

import { translate } from '@docs/i18n/utils'; // t as translate ではなく、index.ts でのエイリアスに合わせる
import type { LocaleKey } from '@docs/i18n/locales';

interface Props {
  title: string;
  lang: LocaleKey; // string から LocaleKey に変更
  version: string;
}

const { title, lang: langProp, version } = Astro.props;
const lang = langProp as LocaleKey; // 型アサーション

// サイドバー項目の定義
const sidebarItems = [
  {
    title: translate('docs.guide', lang),
    items: [
      { title: translate('docs.getting_started', lang), href: `/${lang}/${version}/guide/getting-started` },
      { title: translate('docs.installation', lang), href: `/${lang}/${version}/guide/installation` },
      { title: translate('docs.configuration', lang), href: `/${lang}/${version}/guide/configuration` },
    ]
  },
  {
    title: translate('navigation.api', lang),
    items: [
      { title: translate('docs.overview', lang), href: `/${lang}/${version}/api` },
      { title: translate('docs.reference', lang), href: `/${lang}/${version}/api/reference` },
    ]
  }
];

// 利用可能なバージョン
const versions = [
  { id: 'v1', name: 'Version 1.0', date: new Date('2024-01-01'), isLatest: false },
  { id: 'v2', name: 'Version 2.0', date: new Date('2025-01-01'), isLatest: true }
];
---

<MainLayout title={title} lang={lang} version={version}>
  <div class="flex flex-col md:flex-row gap-8">
    <aside class="w-full md:w-64 shrink-0">
      <div class="sticky top-4 space-y-6">
        <div class="space-y-2">
          <SearchBar placeholder={translate('search.placeholder', lang)} />
          <SearchResults className="mt-2" />
        </div>
        
        <VersionSelector 
          currentVersion={version}
          versions={versions}
          basePath={`/${lang}`}
        />
        
        <Sidebar items={sidebarItems} title={translate('docs.documentation', lang)} />
      </div>
    </aside>
    
    <div class="flex-grow">
      <article class="prose max-w-none">
        <h1>{title}</h1>
        <slot />
      </article>
    </div>
  </div>
</MainLayout>
