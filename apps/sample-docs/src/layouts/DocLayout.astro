---
import MainLayout from './MainLayout.astro';
import { Sidebar } from '@docs/ui/components';
import { VersionSelector } from '@docs/versioning/components';
import { SearchBar, SearchResults } from '@docs/search/components';
import { translate } from '@docs/i18n/utils';
import type { LocaleKey } from '@docs/i18n/locales';

// 設定ファイルのインポート
import docsConfig from '../config/docs.config';
import versions from '../config/versions.config';
import { getSidebarAsync } from '../config/sidebar.config';

interface Props {
  title: string;
  lang: LocaleKey;
  version: string;
}

const { title, lang: langProp, version } = Astro.props;
const lang = langProp as LocaleKey;

// ベースパスの取得
const baseUrl = docsConfig.baseUrl;

// サイドバー項目の取得（非同期）
const sidebarItems = await getSidebarAsync(lang, version, baseUrl);
---

<MainLayout title={title} lang={lang} version={version}>
  <div class="flex flex-col md:flex-row gap-8">
    <aside class="w-full md:w-64 shrink-0">
      <div class="sticky top-4 space-y-6">
        <div class="space-y-2">
          <SearchBar placeholder={translate('search.placeholder', lang)} />
          <SearchResults className="mt-2" lang={lang} />
        </div>
        
        <VersionSelector 
          currentVersion={version}
          versions={versions}
          basePath={`${baseUrl}/${lang}`}
        />
        
        <Sidebar items={sidebarItems} title={translate('docs.documentation', lang)} />
      </div>
    </aside>
    
    <div class="flex-grow">
      <article class="prose max-w-none">
        <h1>{title}</h1>
        <slot />
      </article>
    </div>
  </div>
</MainLayout>
